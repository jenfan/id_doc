<%= form_with(model: document, local: true, :html => { :onsubmit => "showSpinner()", id: 'document_analyze_form' }) do |form| %>
  <% if document.errors.any? %>
    <div id="error_explanation">
      <h2><%= "#{document.errors.count} ошибки" %>:</h2>

      <ul>
        <% document.errors.messages.values.flatten.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label "файл документа" %>
    <%= form.file_field :data %>
  </div>

  <div class="field">
    <%= form.label 'тип классификации' %>
    <%= form.collection_select(:category, ClassificationType.base.all, :slug, :name, {:prompt => 'Выберите тип'}, { onchange: 'showSubCategory();' }) %>
  </div>

  <div class="field" id='document_manual_category_div'>
    <%= form.label 'пользовательский тип классификации' %>
    <%= form.collection_select(:manual_category, ClassificationType.user_label.all, :slug, :name, {:prompt => 'Выберите тип'}) %>
  </div>

  <br>
  <div class="actions">
    <%= form.submit "Начать" %>
  </div>
<% end %>

<div class="loadingio-spinner-blocks-uso5jioje3l" id="loadingio-spinner"><div class="ldio-7r1azknnx19">
<div style='left:38px;top:38px;animation-delay:0s'></div><div style='left:80px;top:38px;animation-delay:0.125s'></div><div style='left:122px;top:38px;animation-delay:0.25s'></div><div style='left:38px;top:80px;animation-delay:0.875s'></div><div style='left:122px;top:80px;animation-delay:0.375s'></div><div style='left:38px;top:122px;animation-delay:0.75s'></div><div style='left:80px;top:122px;animation-delay:0.625s'></div><div style='left:122px;top:122px;animation-delay:0.5s'></div>
</div></div>

<script>
   function showSubCategory() {
      var x = document.getElementById("document_manual_category_div");
      var y = document.getElementById("document_category");
      if (y.value === "user") {
        x.style.display = "block";
      } else {
        x.style.display = "none";
      }
    }
    showSubCategory();

    document.getElementById("loadingio-spinner").style.display = "none";

    function showSpinner() {
      var spinner = document.getElementById("loadingio-spinner")
      spinner.style.display = "block";
      var document_analyze_form = document.getElementById("document_analyze_form")
      document_analyze_form.style.display = "none";
    }
</script>

<style type="text/css">
@keyframes ldio-7r1azknnx19 {
  0% { background: #f8b26a }
  12.5% { background: #f8b26a }
  12.625% { background: #e15b64 }
  100% { background: #e15b64 }
}
.ldio-7r1azknnx19 div {
  position: absolute;
  width: 40px;
  height: 40px;
  background: #e15b64;
  animation: ldio-7r1azknnx19 1s linear infinite;
}
.loadingio-spinner-blocks-uso5jioje3l {
  width: 200px;
  height: 200px;
  display: inline-block;
  overflow: hidden;
  background: #ffffff;
}
.ldio-7r1azknnx19 {
  width: 100%;
  height: 100%;
  position: relative;
  transform: translateZ(0) scale(1);
  backface-visibility: hidden;
  transform-origin: 0 0; /* see note above */
}
.ldio-7r1azknnx19 div { box-sizing: content-box; }
/* generated by https://loading.io/ */
</style>
